From 9babe6446266be1b7d8acd4a776f1f041121d65f Mon Sep 17 00:00:00 2001
From: Andreas Beckmann <anbe@debian.org>
Date: Mon, 3 Jan 2022 13:21:37 +0100
Subject: [PATCH] backport stddef.h changes from 495.44

---
 common/inc/nv-linux.h                        | 10 +++++++++-
 nvidia-modeset/nvidia-modeset-os-interface.h |  6 +++++-
 nvidia-modeset/nvkms.h                       |  6 +++++-
 3 files changed, 19 insertions(+), 3 deletions(-)

diff --git a/common/inc/nv-linux.h b/common/inc/nv-linux.h
index 920383d..0b5b0db 100644
--- a/common/inc/nv-linux.h
+++ b/common/inc/nv-linux.h
@@ -82,7 +82,15 @@
 #include <linux/types.h>            /* pic_t, size_t, __u32, etc        */
 #include <linux/errno.h>            /* error codes                      */
 #include <linux/list.h>             /* circular linked list             */
-#include <linux/stddef.h>           /* NULL, offsetof                   */
+
+#if defined(NV_KERNEL_INTERFACE_LAYER) && defined(__FreeBSD__)
+  #include <sys/stddef.h>   // NULL
+#elif defined(NV_KERNEL_INTERFACE_LAYER) && defined(NV_LINUX)
+  #include <linux/stddef.h> // NULL
+#else
+  #include <stddef.h>       // NULL
+#endif
+
 #include <linux/wait.h>             /* wait queues                      */
 #include <linux/string.h>           /* strchr(), strpbrk()              */
 
diff --git a/nvidia-modeset/nvidia-modeset-os-interface.h b/nvidia-modeset/nvidia-modeset-os-interface.h
index c1ce2b2..d186c74 100644
--- a/nvidia-modeset/nvidia-modeset-os-interface.h
+++ b/nvidia-modeset/nvidia-modeset-os-interface.h
@@ -16,7 +16,11 @@
 #if !defined(_NVIDIA_MODESET_OS_INTERFACE_H_)
 #define _NVIDIA_MODESET_OS_INTERFACE_H_
 
-#include <stddef.h>  /* size_t */
+#if defined(NV_KERNEL_INTERFACE_LAYER) && defined(NV_LINUX)
+#include <linux/stddef.h>  /* size_t */
+#else
+#include <stddef.h>        /* size_t */
+#endif
 #include "nv_stdarg.h"  /* va_list */
 
 #include "nvtypes.h" /* NvU8 */
diff --git a/nvidia-modeset/nvkms.h b/nvidia-modeset/nvkms.h
index d99904f..9acf71e 100644
--- a/nvidia-modeset/nvkms.h
+++ b/nvidia-modeset/nvkms.h
@@ -9,7 +9,11 @@
 #define __NV_KMS_H__
 
 #include "nvtypes.h"
-#include <stddef.h> /* size_t */
+#if defined(NV_KERNEL_INTERFACE_LAYER) && defined(NV_LINUX)
+#include <linux/stddef.h> /* size_t */
+#else
+#include <stddef.h>       /* size_t */
+#endif
 
 #include "nvkms-kapi.h"
 
-- 
2.20.1

