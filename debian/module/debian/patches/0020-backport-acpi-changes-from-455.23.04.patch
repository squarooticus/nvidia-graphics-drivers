From ce2b65fcc7a5c2c235e3d2058e3e17e97b8b654a Mon Sep 17 00:00:00 2001
From: Andreas Beckmann <anbe@debian.org>
Date: Wed, 19 Oct 2022 22:15:29 +0200
Subject: [PATCH] backport acpi changes from 455.23.04

---
 nvidia/nv-acpi.c | 22 ++++++++++++++--------
 1 file changed, 14 insertions(+), 8 deletions(-)

diff --git a/nvidia/nv-acpi.c b/nvidia/nv-acpi.c
index 423eb1d..78949af 100644
--- a/nvidia/nv-acpi.c
+++ b/nvidia/nv-acpi.c
@@ -1185,7 +1185,6 @@ NV_STATUS NV_API_CALL nv_acpi_ddc_method(
     union acpi_object ddc_arg0 = { ACPI_TYPE_INTEGER };
     struct acpi_object_list input = { 1, &ddc_arg0 };
     struct list_head *node, *next;
-    unsigned long long device_id = 0;
     NvU32 i;
     acpi_handle dev_handle  = NULL;
     acpi_handle lcd_dev_handle  = NULL;
@@ -1217,6 +1216,7 @@ NV_STATUS NV_API_CALL nv_acpi_ddc_method(
 
     list_for_each_safe(node, next, &device->children) 
     {
+        unsigned long long device_id = 0;
         struct acpi_device *dev =
             list_entry(node, struct acpi_device, node);
 
@@ -1228,15 +1228,21 @@ NV_STATUS NV_API_CALL nv_acpi_ddc_method(
             /* Couldnt query device_id for this device */
             continue;
 
-        device_id = (device_id & 0xffff);
-
-        if ((device_id == 0x0110) || (device_id == 0x0118) || (device_id == 0x0400)) /* Only for an LCD*/
-        {
-            lcd_dev_handle = dev->handle;
-            nv_printf(NV_DBG_INFO, "NVRM: %s Found LCD: %x\n", __FUNCTION__, device_id);
-            break;
+        switch (device_id & 0xffff) {
+            case 0x0110:
+            case 0x0118:
+            case 0x0400:
+            case 0xA420:
+                lcd_dev_handle = dev->handle;
+                nv_printf(NV_DBG_INFO, "NVRM: %s Found LCD: %x\n",
+                          __FUNCTION__, device_id);
+                break;
+            default:
+                break;
         }
 
+        if (lcd_dev_handle != NULL)
+            break;
     }
 
     if (lcd_dev_handle == NULL)
-- 
2.20.1

