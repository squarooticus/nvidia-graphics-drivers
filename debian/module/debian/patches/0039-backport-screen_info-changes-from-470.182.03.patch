From b408aa0190113c584ebddb58337b368b3adb43fe Mon Sep 17 00:00:00 2001
From: Andreas Beckmann <anbe@debian.org>
Date: Tue, 5 Mar 2024 05:42:16 +0100
Subject: [PATCH] backport screen_info changes from 470.182.03

---
 nvidia/os-interface.c | 14 ++++++++++++++
 1 file changed, 14 insertions(+)

diff --git a/nvidia/os-interface.c b/nvidia/os-interface.c
index b6990f5..f6ead53 100644
--- a/nvidia/os-interface.c
+++ b/nvidia/os-interface.c
@@ -1253,6 +1253,20 @@ void NV_API_CALL os_get_screen_info(
     NvU16 *pFbPitch
 )
 {
+    /*
+     * If the screen info is not found in the registered FBs then fallback
+     * to the screen_info structure.
+     *
+     * The SYSFB_SIMPLEFB option, if enabled, marks VGA/VBE/EFI framebuffers as
+     * generic framebuffers so the new generic system-framebuffer drivers can
+     * be used instead. DRM_SIMPLEDRM drives the generic system-framebuffers
+     * device created by SYSFB_SIMPLEFB.
+     *
+     * SYSFB_SIMPLEFB registers a dummy framebuffer which does not contain the
+     * information required by os_get_screen_info(), therefore you need to
+     * fall back onto the screen_info structure.
+     */
+
 #if NV_IS_EXPORT_SYMBOL_PRESENT_screen_info
     //
     // If there is not a framebuffer console, return 0 size.
-- 
2.20.1

